name: Notify Slack After Deploy

on:
  push:
    branches:
      - main # ë˜ëŠ” ë°°í¬ ë¸Œëœì¹˜ ì´ë¦„

jobs:
  notify-slack:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # ì „ì²´ ì»¤ë°‹ ë‚´ì—­ì„ ê°€ì ¸ì˜¤ë„ë¡ ì„¤ì •

      - name: Get latest 5 commit messages
        id: get_commits
        run: |
          {
            echo "COMMITS<<EOF"
            git log -n 5 --pretty=format:"- %s"
            echo "EOF"
          } >> "$GITHUB_OUTPUT"

      - name: Wait for Netlify Deploy to Finish
        run: |
          echo "Waiting 30 seconds for Netlify to finish deployment..."
          sleep 30

      - name: Send Slack Notification
        env:
          SLACK_FROM_NETLIFY_URL: ${{ secrets.SLACK_FROM_NETLIFY_URL }}
        run: |
          curl -X POST -H 'Content-type: application/json' \
          --data "{\"text\":\"ğŸ·ì„¸ìƒì—!! ìƒˆë¡œìš´ ë°°í¬ ë²„ì „ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆì§€ ë­ì•¼??!!\nğŸ”— https://likelionhackathon.netlify.app\n\nì´ë²ˆ ë°°í¬ ì»¤ë°‹:\n${{ steps.get_commits.outputs.COMMITS }}\"}" \
          $SLACK_FROM_NETLIFY_URL